
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Sepolia dApp</title>

  <!-- Ethers.js v6 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 25px;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    button {
      padding: 10px 16px;
      margin-top: 6px;
      cursor: pointer;
    }
    input {
      padding: 8px;
      width: 100%;
      margin-top: 4px;
      box-sizing: border-box;
    }
    #status {
      margin-top: 15px;
      min-height: 20px;
      color: #444;
    }
  </style>
</head>
<body>

  <h2>My Sepolia dApp</h2>

  <button id="connect">Connect MetaMask</button>
  <p>Account: <span id="account">Not connected</span></p>

  <hr>

  <h3>My Balance</h3>
  <p><span id="balance">0</span> ETH</p>
  <button id="refreshBalance">Refresh Balance</button>

  <hr>

  <h3>Deposit</h3>
  <input id="depositAmount" type="number" placeholder="Amount in ETH" step="0.0001">
  <button id="depositBtn">Deposit</button>

  <hr>

  <h3>Withdraw</h3>
  <input id="withdrawAmount" type="number" placeholder="Amount in ETH" step="0.0001">
  <button id="withdrawBtn">Withdraw</button>

  <div id="status"></div>

  <script>
    /********************************************
     * Contract Address
     ********************************************/
    const CONTRACT_ADDRESS = "0x8D383091126C1C60e474F324EddFb67bF248c990";

    /********************************************
     * ABI
     ********************************************/
    const CONTRACT_ABI = [
      {
        "inputs": [],
        "name": "deposit",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "user", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "Deposited",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "withdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "user", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "Withdrawn",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "user", "type": "address" }
        ],
        "name": "balanceOf",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "contractBalance",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "myBalance",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let provider, signer, contract;

    const connectBtn = document.getElementById("connect");
    const accountSpan = document.getElementById("account");
    const balanceSpan = document.getElementById("balance");
    const refreshBtn = document.getElementById("refreshBalance");
    const depositInput = document.getElementById("depositAmount");
    const depositBtn = document.getElementById("depositBtn");
    const withdrawInput = document.getElementById("withdrawAmount");
    const withdrawBtn = document.getElementById("withdrawBtn");
    const statusDiv = document.getElementById("status");

    function setStatus(msg) {
      console.log(msg);
      statusDiv.textContent = msg;
    }

    // Connect MetaMask
    connectBtn.onclick = async () => {
      if (!window.ethereum) return alert("MetaMask not installed.");

      try {
        await ethereum.request({ method: "eth_requestAccounts" });

        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

        const address = await signer.getAddress();
        accountSpan.textContent = address;

        setStatus("Connected!");
        refreshBalance();
      } catch (error) {
        console.error(error);
        setStatus("Error connecting MetaMask");
      }
    };

    // Refresh balance
    async function refreshBalance() {
      if (!contract) return setStatus("Connect wallet first");

      try {
        const balanceWei = await contract.myBalance();
        const balanceEth = ethers.formatEther(balanceWei);
        balanceSpan.textContent = balanceEth;
        setStatus("Balance updated");
      } catch (error) {
        console.error(error);
        setStatus("Failed to fetch balance");
      }
    }

    refreshBtn.onclick = refreshBalance;

    // Deposit
    depositBtn.onclick = async () => {
      if (!contract) return setStatus("Connect wallet first");

      const amount = depositInput.value;
      if (!amount || Number(amount) <= 0) return setStatus("Enter valid amount");

      try {
        const tx = await contract.deposit({ value: ethers.parseEther(amount) });
        setStatus("Waiting for confirmation...");
        await tx.wait();
        setStatus("Deposit successful!");
        refreshBalance();
      } catch (error) {
        console.error(error);
        setStatus("Deposit failed");
      }
    };

    // Withdraw
    withdrawBtn.onclick = async () => {
      if (!contract) return setStatus("Connect wallet first");

      const amount = withdrawInput.value;
      if (!amount || Number(amount) <= 0) return setStatus("Enter valid amount");

      try {
        const tx = await contract.withdraw(ethers.parseEther(amount));
        setStatus("Waiting for confirmation...");
        await tx.wait();
        setStatus("Withdraw successful!");
        refreshBalance();
      } catch (error) {
        console.error(error);
        setStatus("Withdraw failed");
      }
    };

    // Auto-reload on account / network change
    if (window.ethereum) {
      window.ethereum.on("accountsChanged", () => location.reload());
      window.ethereum.on("chainChanged", () => location.reload());
    }
  </script>
</body>
</html>
